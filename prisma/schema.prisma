generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// SugarCRM Admin Users - synced from LinkCRM
model AdminUser {
  id            String   @id @default(cuid())
  legacyId      String   @unique // SugarCRM user id
  email         String   @unique
  passwordHash  String   // MD5 hash from SugarCRM
  username      String   @unique
  firstName     String?
  lastName      String
  isActive      Boolean  @default(true)
  lastLogin     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([email])
  @@index([username])
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  password  String
  role      UserRole
  firstName String?
  lastName  String?
  phone     String?
  googleId  String?    @unique // Google OAuth ID
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  corporate Corporate?
  linguist  Linguist?

  @@index([email])
  @@index([googleId])
}

model Corporate {
  id                  String    @id @default(cuid())
  customerNumber      Int?      @unique // Sequential customer number
  legacyId            String?   @unique // SugarCRM account id
  userId              String    @unique
  company             String
  website             String?
  industry            String?
  billingAddress      String?
  billingCity         String?
  billingState        String?
  billingZip          String?
  billingCountry      String?
  shippingAddress     String?
  shippingCity        String?
  shippingState       String?
  shippingZip         String?
  shippingCountry     String?
  taxId               String?
  paymentTerms        String?
  creditLimit         Float?
  paymentCodeEnabled  Boolean   @default(false) // Allow payment by code
  paymentCode         String?   // The payment code for this corporate
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  contacts            Contact[]
  invoices            Invoice[]
  orders              Order[]
  quotes              Quote[]
  projects            Project[]

  @@map("Customer")
  @@index([userId])
}

model Contact {
  id            String    @id @default(cuid())
  contactNumber Int?      @unique // Sequential contact number
  legacyId      String?   @unique  // CRM contact ID
  corporateId   String    @map("customerId")
  firstName     String
  lastName      String
  title         String?
  email         String?
  phone         String?
  isPrimary     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  corporate     Corporate @relation(fields: [corporateId], references: [id], onDelete: Cascade)
  quotes        Quote[]
  projects      Project[]

  @@map("CustomerContact")
  @@index([corporateId])
  @@index([legacyId])
}

model Language {
  id                  String             @id @default(cuid())
  code                String             @unique
  name                String
  nativeName          String?
  createdAt           DateTime           @default(now())
  sourceLanguagePairs LanguagePair[]     @relation("sourceLanguage")
  targetLanguagePairs LanguagePair[]     @relation("targetLanguage")
  linguistLanguages   LinguistLanguage[]
  pricingAsSource     PricingRule[]      @relation("pricingSourceLang")
  pricingAsTarget     PricingRule[]      @relation("pricingTargetLang")
  quotesAsSource      Quote[]            @relation("QuoteSourceLanguage")
  quotesAsTarget      Quote[]            @relation("QuoteTargetLanguage")
  projectsAsSource    Project[]          @relation("ProjectSourceLanguage")
  projectsAsTarget    Project[]          @relation("ProjectTargetLanguage")

  @@index([code])
}

model LanguagePair {
  id               String       @id @default(cuid())
  sourceLanguageId String
  targetLanguageId String
  ratePerWord      Float
  minimumCharge    Float
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  assignments      Assignment[]
  sourceLanguage   Language     @relation("sourceLanguage", fields: [sourceLanguageId], references: [id], onDelete: Cascade)
  targetLanguage   Language     @relation("targetLanguage", fields: [targetLanguageId], references: [id], onDelete: Cascade)
  quotes           Quote[]

  @@unique([sourceLanguageId, targetLanguageId])
  @@index([sourceLanguageId, targetLanguageId])
}

model Linguist {
  id                   String             @id @default(cuid())
  linguistNumber       Int?               @unique // Sequential number (1, 2, 3...)
  crmId                String?            @unique // SugarCRM vendor ID
  userId               String             @unique
  firstName            String
  lastName             String
  email                String
  phone                String?
  dateOfBirth          DateTime?
  gender               String?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  country              String?
  nativeLanguage       String?
  languages            String[]           @default([])
  bio                  String?
  experience           String?
  specializations      String[]           @default([])
  education            String?
  certifications       String?
  ratePerWord          Float?
  minimumCharge        Float?
  
  // Interpretation specific fields
  hourlyRate           Float?             // Interpretation hourly rate
  availableForOnSite   Boolean            @default(false)
  maxTravelDistance    Int?               // Maximum travel distance in miles
  
  // Geo location for on-site matching
  latitude             Float?
  longitude            Float?
  
  isActive             Boolean            @default(true)
  isVerified           Boolean            @default(false)
  verificationDate     DateTime?
  portfolioUrl         String?
  portfolioItems       String?
  totalQuotesCompleted Int                @default(0)
  averageRating        Float?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  assignments          Assignment[]
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  linguistLanguages    LinguistLanguage[]
  jobInvitations       JobInvitation[]
  purchaseOrders       PurchaseOrder[]

  @@index([state])
  @@index([isActive])
  @@index([isVerified])
  @@index([availableForOnSite])
}

model LinguistLanguage {
  id                String        @id @default(cuid())
  linguistId        String
  languageId        String
  level             LanguageLevel
  discipline        Discipline
  ratePerWord       Float?
  minimumCharge     Float?
  yearsOfExperience Int?
  certifications    String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  language          Language      @relation(fields: [languageId], references: [id])
  linguist          Linguist      @relation(fields: [linguistId], references: [id], onDelete: Cascade)

  @@unique([linguistId, languageId])
  @@index([linguistId])
  @@index([languageId])
}

model State {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())

  @@index([code])
  @@index([slug])
}

model Quote {
  id                    String        @id @default(cuid())
  legacyId              String?       @unique
  quoteNumber           String        @unique
  customerId            String
  contactId             String?
  languagePairId        String?
  status                QuoteStatus   @default(DRAFT)
  description           String?
  sourceLanguage        String[]      @default([])
  targetLanguage        String[]      @default([])
  wordCount             Float?
  unitOfIssue           String?
  ratePerUnit           Float
  minimumCharge         Float
  subtotal              Float?
  tax                   Float?
  total                 Float?
  requestedDeliveryDate DateTime?
  actualDeliveryDate    DateTime?
  notes                 String?
  internalNotes         String?
  
  // CRM Billing Contact (person who ordered)
  billingContactName    String?       // billing_contact from CRM
  billingContactCrmId   String?       // billing_contact_id from CRM (SugarCRM contact ID)
  
  // Assignment/Interpretation Details
  discipline            String?
  assignmentDate        DateTime?
  assignmentTime        String?
  estimatedDuration     String?
  onSiteContact         String?
  contactPersonPhone    String?
  contactPersonEmail    String?
  
  // New Quote Wizard Fields
  serviceType           String?       // 'translation' or 'interpretation'
  sourceLanguageId      String?
  targetLanguageId      String?
  totalPrice            Float?
  
  // Stripe Payment Fields
  stripeSessionId       String?
  stripePaymentIntentId String?
  paymentStatus         String?       @default("unpaid") // unpaid, pending, paid, failed, expired
  paidAt                DateTime?
  
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  assignments           Assignment[]
  orders                Order[]
  project               Project?
  corporate             Corporate     @relation(fields: [customerId], references: [id])
  contact               Contact?      @relation(fields: [contactId], references: [id])
  languagePair          LanguagePair? @relation(fields: [languagePairId], references: [id])
  srcLanguage           Language?     @relation("QuoteSourceLanguage", fields: [sourceLanguageId], references: [id])
  tgtLanguage           Language?     @relation("QuoteTargetLanguage", fields: [targetLanguageId], references: [id])

  @@index([customerId])
  @@index([contactId])
  @@index([status])
  @@index([quoteNumber])
  @@index([legacyId])
}

model Project {
  id               String          @id @default(cuid())
  projectNumber    String          @unique @default(cuid())
  quoteId          String?         @unique
  customerId       String?
  contactId        String?
  corporateId      String?
  name             String?
  description      String?
  status           ProjectStatus   @default(IN_PROGRESS)
  startDate        DateTime        @default(now())
  dueDate          DateTime?
  completedDate    DateTime?
  notes            String?
  internalNotes    String?
  serviceType      String?
  sourceLanguageId String?
  targetLanguageId String?
  totalPrice       Float?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  quote            Quote?          @relation(fields: [quoteId], references: [id])
  corporate        Corporate?      @relation(fields: [customerId], references: [id])
  contact          Contact?        @relation(fields: [contactId], references: [id])
  srcLanguage      Language?       @relation("ProjectSourceLanguage", fields: [sourceLanguageId], references: [id])
  tgtLanguage      Language?       @relation("ProjectTargetLanguage", fields: [targetLanguageId], references: [id])
  jobInvitations   JobInvitation[]
  purchaseOrders   PurchaseOrder[]

  @@index([customerId])
  @@index([status])
  @@index([projectNumber])
}

model Order {
  id          String       @id @default(cuid())
  orderNumber String       @unique
  quoteId     String
  customerId  String
  status      OrderStatus  @default(PENDING)
  subtotal    Float
  tax         Float?
  total       Float
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  completedAt DateTime?
  assignments Assignment[]
  invoice     Invoice?
  corporate   Corporate    @relation(fields: [customerId], references: [id])
  quote       Quote        @relation(fields: [quoteId], references: [id])

  @@index([customerId])
  @@index([status])
  @@index([orderNumber])
}

model Assignment {
  id             String           @id @default(cuid())
  orderId        String
  quoteId        String?
  linguistId     String
  languagePairId String
  status         AssignmentStatus @default(PENDING)
  assignedAt     DateTime         @default(now())
  acceptedAt     DateTime?
  declinedAt     DateTime?
  startedAt      DateTime?
  completedAt    DateTime?
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  languagePair   LanguagePair     @relation(fields: [languagePairId], references: [id])
  linguist       Linguist         @relation(fields: [linguistId], references: [id])
  order          Order            @relation(fields: [orderId], references: [id])
  quote          Quote?           @relation(fields: [quoteId], references: [id])

  @@unique([orderId, linguistId])
  @@index([orderId])
  @@index([linguistId])
  @@index([status])
}

model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique
  orderId       String    @unique
  customerId    String
  subtotal      Float
  tax           Float?
  total         Float
  issueDate     DateTime  @default(now())
  dueDate       DateTime
  paidAt        DateTime?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  corporate     Corporate @relation(fields: [customerId], references: [id])
  order         Order     @relation(fields: [orderId], references: [id])
  payments      Payment[]

  @@index([customerId])
  @@index([invoiceNumber])
}

model PurchaseOrder {
  id          String        @id @default(cuid())
  poNumber    String        @unique
  linguistId  String
  projectId   String?
  description String?
  quantity    Float?
  unit        String?       @default("words")
  rate        Float?
  total       Float
  status      POStatus      @default(PENDING)
  issuedAt    DateTime      @default(now())
  paidAt      DateTime?
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  linguist    Linguist      @relation(fields: [linguistId], references: [id])
  project     Project?      @relation(fields: [projectId], references: [id])

  @@index([linguistId])
  @@index([projectId])
  @@index([poNumber])
  @@index([status])
}

model Payment {
  id            String        @id @default(cuid())
  invoiceId     String
  amount        Float
  status        PaymentStatus @default(PENDING)
  method        String?
  transactionId String?
  processedAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  invoice       Invoice       @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([transactionId])
}

model ActivityLog {
  id         String   @id @default(cuid())
  action     String
  entityType String
  entityId   String
  changes    String?
  createdAt  DateTime @default(now())

  @@index([entityType, entityId])
  @@index([action])
}

enum UserRole {
  ADMIN
  CUSTOMER
  LINGUIST
  MANAGER
}

enum LanguageLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  NATIVE
  BILINGUAL
}

enum Discipline {
  TRANSLATION
  INTERPRETATION
  BOTH
}

enum QuoteStatus {
  DRAFT
  REVIEWING          // Was QUOTE_SENT - "Quote Sent" in CRM
  NEGOTIATION        // Was NEGOTIATION_REVIEW - "Negotiation/Review" in CRM
  FOLLOW_UP
  INVOICE_PAID
  INVOICE_NOT_PAID
  REJECTED_PRICE     // "Rejected due to Price" in CRM
  REJECTED_OTHER     // "Rejected (Other)" in CRM
  REFUND
  BAD_DEBT
}

enum ProjectStatus {
  IN_PROGRESS
  PAUSED
  REMOVED
  COMPLETED
  SEEKING_INTERPRETER
  INTERPRETER_ASSIGNED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  REVIEW
  COMPLETED
  CANCELLED
  INVOICED
  PAID
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum POStatus {
  PENDING
  APPROVED
  SENT
  PAID
  CANCELLED
}

enum AssignmentStatus {
  PENDING
  ACCEPTED
  DECLINED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Service type for pricing
enum ServiceType {
  TRANSLATION
  INTERPRETATION
  TRANSCRIPTION
}

// Interpretation type for pricing modifiers
enum InterpretationType {
  ON_SITE
  VIDEO_REMOTE
  PHONE
}

// Delivery speed for rush pricing
enum DeliverySpeed {
  STANDARD      // Normal delivery
  RUSH_48H      // 48 hour delivery
  RUSH_24H      // 24 hour delivery
  SAME_DAY      // Same day delivery
}

// Pricing rules for Translation and Interpretation services
model PricingRule {
  id                  String              @id @default(cuid())
  name                String              // e.g., "Spanish Translation Standard", "Medical Interpretation NYC"
  serviceType         ServiceType
  
  // Language pair (optional - null means default rate)
  sourceLanguageId    String?
  targetLanguageId    String?
  sourceLanguage      Language?           @relation("pricingSourceLang", fields: [sourceLanguageId], references: [id])
  targetLanguage      Language?           @relation("pricingTargetLang", fields: [targetLanguageId], references: [id])
  
  // Interpretation specific
  interpretationType  InterpretationType?
  
  // Regional pricing (for on-site interpretation)
  state               String?             // US State code for regional pricing
  
  // Translation rates
  perWordRate         Decimal?            @db.Decimal(8, 4)  // e.g., 0.12 per word
  
  // Interpretation rates  
  perHourRate         Decimal?            @db.Decimal(8, 2)  // e.g., 75.00 per hour
  minimumHours        Decimal?            @db.Decimal(4, 2)  // e.g., 2.00 minimum
  travelFee           Decimal?            @db.Decimal(8, 2)  // flat travel fee for on-site
  
  // Common rates
  minimumCharge       Decimal?            @db.Decimal(8, 2)  // minimum charge for any job
  
  // Rush/expedited multipliers
  rush24hMultiplier   Decimal?            @db.Decimal(4, 2)  // e.g., 1.50 for 50% extra
  rush48hMultiplier   Decimal?            @db.Decimal(4, 2)  // e.g., 1.25 for 25% extra
  sameDayMultiplier   Decimal?            @db.Decimal(4, 2)  // e.g., 2.00 for double
  
  // Volume discounts (for translation)
  volumeDiscount1kWords   Decimal?        @db.Decimal(4, 2)  // discount % for 1000+ words
  volumeDiscount5kWords   Decimal?        @db.Decimal(4, 2)  // discount % for 5000+ words
  volumeDiscount10kWords  Decimal?        @db.Decimal(4, 2)  // discount % for 10000+ words
  
  // Document type multipliers
  documentTypeLegal       Decimal?        @db.Decimal(4, 2)  // multiplier for legal docs
  documentTypeMedical     Decimal?        @db.Decimal(4, 2)  // multiplier for medical docs
  documentTypeTechnical   Decimal?        @db.Decimal(4, 2)  // multiplier for technical docs
  
  // Status
  isDefault           Boolean             @default(false)    // default rate for service type
  isActive            Boolean             @default(true)
  priority            Int                 @default(0)        // higher = more specific/override
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([serviceType])
  @@index([sourceLanguageId, targetLanguageId])
  @@index([state])
  @@index([isActive])
}

enum LeadStatus {
  NEW
  ASSIGNED
  IN_PROCESS
  CONVERTED
  RECYCLED
  DEAD
}

model Lead {
  id                     String     @id @default(cuid())
  leadNumber             Int?       @unique // Sequential lead number
  legacyId               String?    @unique // Original SugarCRM ID
  firstName              String?
  lastName               String
  email                  String?
  phone                  String?
  phoneMobile            String?
  phoneWork              String?
  phoneFax               String?
  company                String?
  title                  String?
  department             String?
  website                String?
  description            String?
  
  // Address
  addressStreet          String?
  addressCity            String?
  addressState           String?
  addressPostalCode      String?
  addressCountry         String?
  
  // Lead Info
  source                 String?     // Where the lead came from
  sourceDescription      String?
  status                 LeadStatus  @default(NEW)
  statusDescription      String?
  industry               String?
  referredBy             String?
  
  // Custom Fields from LinkCRM
  discipline             String?     // Translation, Interpretation, etc.
  sourceLanguage         String?
  targetLanguage         String?
  customerType           String?     // Individual, Corporate
  leadRanking            String?     // Hot, Warm, Cold
  
  // Interpretation Assignment Details
  assignmentDate         DateTime?
  assignmentTime         String?
  estimatedDuration      String?
  onSiteContact          String?
  contactPersonPhone     String?
  contactPersonEmail     String?
  assignmentAddress      String?
  assignmentCity         String?
  assignmentState        String?
  assignmentZipCode      String?
  isCertified            Boolean     @default(false)
  estimatedFees          String?
  numberOfParticipants   String?
  numberOfSpeakers       String?
  meetingType            String?
  requestedVendorId      String?
  
  // Conversion
  isConverted            Boolean     @default(false)
  convertedAt            DateTime?
  convertedToCustomerId  String?
  
  // System
  doNotCall              Boolean     @default(false)
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt

  @@index([email])
  @@index([status])
  @@index([lastName])
  @@index([company])
}

// Legacy Quotes from LinkCRM - all disciplines (Translation, Interpretation, etc.)
model LegacyQuote {
  id                    String    @id @default(cuid())
  legacyId              String    @unique // SugarCRM quote id
  number                String?   // Quote number (e.g., "10168")
  name                  String?   // Quote name/title
  description           String?
  
  // Billing Info
  billingAccount        String?
  billingAccountId      String?   // SugarCRM account id
  billingContact        String?
  billingContactId      String?   // SugarCRM contact id
  billingAddress        String?
  billingCity           String?
  billingState          String?
  billingPostal         String?
  billingCountry        String?
  
  // Shipping Info
  shippingAccount       String?
  shippingAccountId     String?
  shippingContact       String?
  shippingContactId     String?
  shippingAddress       String?
  shippingCity          String?
  shippingState         String?
  shippingPostal        String?
  shippingCountry       String?
  
  // Status & Dates
  stage                 String?   // Draft, Negotiation, Delivered, etc.
  expiration            DateTime?
  estimatedCompletion   DateTime?
  
  // Amounts
  subtotalAmount        Decimal?  @db.Decimal(16, 2)
  taxAmount             Decimal?  @db.Decimal(8, 2)
  shippingAmount        Decimal?  @db.Decimal(8, 2)
  totalAmount           Decimal?  @db.Decimal(16, 2)
  paymentsReceived      Decimal?  @db.Decimal(8, 2)
  balanceDue            Decimal?  @db.Decimal(8, 2)
  
  // Payment Info
  paymentDate           DateTime?
  paymentType           String?
  checkNumber           String?
  
  // Service Details (for all disciplines)
  discipline            String?   // Translation, Interpretation, etc.
  sourceLanguage        String?
  targetLanguage        String?
  
  // Assignment Details (primarily for Interpretation)
  assignmentDate        DateTime?
  assignmentTime        String?
  estimatedDuration     String?
  onSiteContact         String?
  contactPersonPhone    String?
  contactPersonEmail    String?
  
  // Other
  terms                 String?
  ponumber              String?
  opportunityId         String?
  gsa                   Boolean   @default(false)
  partnerId             String?
  
  // Relations
  assignedUserId        String?
  
  // System
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([number])
  @@index([billingAccountId])
  @@index([billingContactId])
  @@index([stage])
  @@index([discipline])
}

// Job Invitation for interpretation assignments
model JobInvitation {
  id               String              @id @default(cuid())
  projectId        String
  linguistId       String
  token            String              @unique // Unique token for accept/decline links
  status           JobInvitationStatus @default(PENDING)
  
  // Event details
  eventDate        DateTime
  eventTime        String
  eventDuration    Float               // hours
  eventLocation    String
  eventDescription String?
  distance         Float?              // miles from linguist
  
  // Response tracking
  respondedAt      DateTime?
  declineReason    String?
  
  // Expiration
  expiresAt        DateTime
  
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  
  // Relations
  project          Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  linguist         Linguist            @relation(fields: [linguistId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([linguistId])
  @@index([token])
  @@index([status])
}

enum JobInvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

// Coupon/Discount Codes
model Coupon {
  id              String        @id @default(cuid())
  code            String        @unique
  description     String?
  discountType    DiscountType  @default(PERCENTAGE)
  discountValue   Float         // percentage (0-100) or fixed amount
  minimumOrder    Float?        // minimum order amount to apply
  maxDiscount     Float?        // maximum discount amount (for percentage)
  maxUses         Int?          // null = unlimited
  usedCount       Int           @default(0)
  validFrom       DateTime      @default(now())
  validUntil      DateTime?
  isActive        Boolean       @default(true)
  
  // Restrictions
  serviceType     String?       // translation, interpretation, or null for all
  firstOrderOnly  Boolean       @default(false)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  usages          CouponUsage[]

  @@index([code])
  @@index([isActive])
}

model CouponUsage {
  id          String    @id @default(cuid())
  couponId    String
  quoteId     String?
  customerId  String?
  usedAt      DateTime  @default(now())
  discount    Float     // actual discount applied
  
  coupon      Coupon    @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([quoteId])
  @@index([customerId])
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

// =============================================
// ADMINISTRATIVE SETTINGS
// =============================================

// Company/Business Settings - singleton table
model CompanySettings {
  id                    String    @id @default("company_settings")
  
  // Company Information
  companyName           String    @default("Link Translations")
  legalName             String?   // Legal entity name
  tagline               String?   @default("Professional Language Services")
  
  // Contact Information
  email                 String    @default("info@linktranslations.com")
  phone                 String    @default("(203) 254-1181")
  tollFree              String?   @default("(800) 707-6752")
  fax                   String?
  website               String    @default("https://www.linktranslations.com")
  
  // Address
  address               String    @default("2070 Post Road")
  city                  String    @default("Darien")
  state                 String    @default("CT")
  zipCode               String    @default("06820")
  country               String    @default("USA")
  
  // Business Details
  taxId                 String?   // EIN/Tax ID
  dunsNumber            String?   // D-U-N-S Number
  cageCode              String?   // CAGE Code for government contracts
  
  // Branding
  logoUrl               String?
  faviconUrl            String?
  primaryColor          String    @default("#2563eb")
  secondaryColor        String    @default("#4f46e5")
  
  // Social Media
  linkedIn              String?
  twitter               String?
  facebook              String?
  
  // PDF Settings
  pdfHeaderText         String?   @default("Professional Translation & Interpretation Services")
  pdfFooterText         String?
  pdfTermsAndConditions String?   @db.Text
  
  // Quote Settings
  quoteValidityDays     Int       @default(30)
  quotePrefix           String    @default("QT")
  quoteAutoNumber       Boolean   @default(true)
  
  // Invoice Settings
  invoicePrefix         String    @default("INV")
  invoicePaymentTerms   String    @default("Net 30")
  invoiceBankDetails    String?   @db.Text
  
  // Purchase Order Settings
  poPrefix              String    @default("PO")
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

// Email Templates - customizable email content
model EmailTemplate {
  id              String    @id @default(cuid())
  slug            String    @unique // e.g., "welcome", "quote-created", "payment-received"
  name            String    // Display name
  description     String?   // What this template is for
  subject         String    // Email subject line (supports variables like {{customerName}})
  htmlContent     String    @db.Text // HTML template with variables
  textContent     String?   @db.Text // Plain text version
  variables       String[]  // Available variables: ["customerName", "quoteNumber", etc.]
  isActive        Boolean   @default(true)
  isSystem        Boolean   @default(false) // System templates can't be deleted
  
  category        EmailCategory @default(TRANSACTIONAL)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  emailLogs       EmailLog[]

  @@index([slug])
  @@index([category])
}

// Email Log - track all sent emails
model EmailLog {
  id              String        @id @default(cuid())
  templateId      String?
  
  to              String[]      // Recipient email(s)
  cc              String[]      @default([])
  bcc             String[]      @default([])
  from            String
  replyTo         String?
  
  subject         String
  htmlContent     String?       @db.Text
  
  status          EmailStatus   @default(PENDING)
  error           String?
  
  // Tracking
  sentAt          DateTime?
  deliveredAt     DateTime?
  openedAt        DateTime?
  clickedAt       DateTime?
  bouncedAt       DateTime?
  
  // Related entities
  quoteId         String?
  projectId       String?
  customerId      String?
  linguistId      String?
  
  // External IDs
  externalId      String?       // Resend message ID
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  template        EmailTemplate? @relation(fields: [templateId], references: [id])

  @@index([templateId])
  @@index([status])
  @@index([to])
  @@index([quoteId])
  @@index([projectId])
}

// PDF Templates - document templates configuration
model PdfTemplate {
  id                String        @id @default(cuid())
  type              PdfType       @unique // QUOTE, INVOICE, PURCHASE_ORDER
  name              String
  
  // Header
  showLogo          Boolean       @default(true)
  headerBackgroundColor String    @default("#2563eb")
  headerTextColor   String        @default("#ffffff")
  
  // Content
  showCompanyAddress Boolean      @default(true)
  showContactInfo   Boolean       @default(true)
  
  // Table styling
  tableHeaderColor  String        @default("#2563eb")
  alternateRowColor String        @default("#f9fafb")
  
  // Footer
  footerText        String?       @db.Text
  showPageNumbers   Boolean       @default(true)
  
  // Terms
  termsTitle        String?       @default("Terms & Conditions")
  termsContent      String?       @db.Text
  
  // Notes section
  defaultNotes      String?       @db.Text
  
  isActive          Boolean       @default(true)
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
}

enum EmailCategory {
  TRANSACTIONAL     // Order confirmations, receipts
  NOTIFICATION      // Updates, reminders
  MARKETING         // Promotions, newsletters
  SYSTEM            // Password reset, verification
}

enum EmailStatus {
  PENDING
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum PdfType {
  QUOTE
  INVOICE
  PURCHASE_ORDER
  PROJECT_SUMMARY
  CERTIFICATE
}
