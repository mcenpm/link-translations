generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// SugarCRM Admin Users - synced from LinkCRM
model AdminUser {
  id            String   @id @default(cuid())
  legacyId      String   @unique // SugarCRM user id
  email         String   @unique
  passwordHash  String   // MD5 hash from SugarCRM
  username      String   @unique
  firstName     String?
  lastName      String
  isActive      Boolean  @default(true)
  lastLogin     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([email])
  @@index([username])
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  role      UserRole
  firstName String?
  lastName  String?
  phone     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  customer  Customer?
  linguist  Linguist?

  @@index([email])
}

model Customer {
  id              String            @id @default(cuid())
  userId          String            @unique
  company         String
  website         String?
  industry        String?
  billingAddress  String?
  billingCity     String?
  billingState    String?
  billingZip      String?
  billingCountry  String?
  shippingAddress String?
  shippingCity    String?
  shippingState   String?
  shippingZip     String?
  shippingCountry String?
  taxId           String?
  paymentTerms    String?
  creditLimit     Float?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  contacts        CustomerContact[]
  invoices        Invoice[]
  orders          Order[]
  quotes          Quote[]
  projects        Project[]

  @@index([userId])
}

model CustomerContact {
  id         String   @id @default(cuid())
  customerId String
  firstName  String
  lastName   String
  title      String?
  email      String?
  phone      String?
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  quotes     Quote[]

  @@index([customerId])
}

model Language {
  id                  String             @id @default(cuid())
  code                String             @unique
  name                String
  nativeName          String?
  createdAt           DateTime           @default(now())
  sourceLanguagePairs LanguagePair[]     @relation("sourceLanguage")
  targetLanguagePairs LanguagePair[]     @relation("targetLanguage")
  linguistLanguages   LinguistLanguage[]

  @@index([code])
}

model LanguagePair {
  id               String       @id @default(cuid())
  sourceLanguageId String
  targetLanguageId String
  ratePerWord      Float
  minimumCharge    Float
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  assignments      Assignment[]
  sourceLanguage   Language     @relation("sourceLanguage", fields: [sourceLanguageId], references: [id], onDelete: Cascade)
  targetLanguage   Language     @relation("targetLanguage", fields: [targetLanguageId], references: [id], onDelete: Cascade)
  quotes           Quote[]

  @@unique([sourceLanguageId, targetLanguageId])
  @@index([sourceLanguageId, targetLanguageId])
}

model Linguist {
  id                   String             @id @default(cuid())
  userId               String             @unique
  firstName            String
  lastName             String
  email                String
  phone                String?
  dateOfBirth          DateTime?
  gender               String?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  country              String?
  nativeLanguage       String?
  languages            String[]           @default([])
  bio                  String?
  experience           String?
  specializations      String[]           @default([])
  education            String?
  certifications       String?
  ratePerWord          Float?
  minimumCharge        Float?
  isActive             Boolean            @default(true)
  isVerified           Boolean            @default(false)
  verificationDate     DateTime?
  portfolioUrl         String?
  portfolioItems       String?
  totalQuotesCompleted Int                @default(0)
  averageRating        Float?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  assignments          Assignment[]
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  linguistLanguages    LinguistLanguage[]

  @@index([state])
  @@index([isActive])
  @@index([isVerified])
}

model LinguistLanguage {
  id                String        @id @default(cuid())
  linguistId        String
  languageId        String
  level             LanguageLevel
  discipline        Discipline
  ratePerWord       Float?
  minimumCharge     Float?
  yearsOfExperience Int?
  certifications    String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  language          Language      @relation(fields: [languageId], references: [id])
  linguist          Linguist      @relation(fields: [linguistId], references: [id], onDelete: Cascade)

  @@unique([linguistId, languageId])
  @@index([linguistId])
  @@index([languageId])
}

model State {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())

  @@index([code])
  @@index([slug])
}

model Quote {
  id                    String        @id @default(cuid())
  legacyId              String?       @unique
  quoteNumber           String        @unique
  customerId            String
  contactId             String?
  languagePairId        String?
  status                QuoteStatus   @default(DRAFT)
  description           String?
  sourceLanguage        String
  targetLanguage        String
  wordCount             Float?
  unitOfIssue           String?
  ratePerUnit           Float
  minimumCharge         Float
  subtotal              Float?
  tax                   Float?
  total                 Float?
  requestedDeliveryDate DateTime?
  actualDeliveryDate    DateTime?
  notes                 String?
  internalNotes         String?
  
  // Assignment/Interpretation Details
  discipline            String?
  assignmentDate        DateTime?
  assignmentTime        String?
  estimatedDuration     String?
  onSiteContact         String?
  contactPersonPhone    String?
  contactPersonEmail    String?
  
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  assignments           Assignment[]
  orders                Order[]
  project               Project?
  customer              Customer      @relation(fields: [customerId], references: [id])
  contact               CustomerContact? @relation(fields: [contactId], references: [id])
  languagePair          LanguagePair? @relation(fields: [languagePairId], references: [id])

  @@index([customerId])
  @@index([contactId])
  @@index([status])
  @@index([quoteNumber])
  @@index([legacyId])
}

model Project {
  id              String        @id @default(cuid())
  projectNumber   String        @unique
  quoteId         String        @unique
  customerId      String
  name            String?
  description     String?
  status          ProjectStatus @default(IN_PROGRESS)
  startDate       DateTime      @default(now())
  dueDate         DateTime?
  completedDate   DateTime?
  notes           String?
  internalNotes   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  quote           Quote         @relation(fields: [quoteId], references: [id])
  customer        Customer      @relation(fields: [customerId], references: [id])

  @@index([customerId])
  @@index([status])
  @@index([projectNumber])
}

model Order {
  id          String       @id @default(cuid())
  orderNumber String       @unique
  quoteId     String
  customerId  String
  status      OrderStatus  @default(PENDING)
  subtotal    Float
  tax         Float?
  total       Float
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  completedAt DateTime?
  assignments Assignment[]
  invoice     Invoice?
  customer    Customer     @relation(fields: [customerId], references: [id])
  quote       Quote        @relation(fields: [quoteId], references: [id])

  @@index([customerId])
  @@index([status])
  @@index([orderNumber])
}

model Assignment {
  id             String           @id @default(cuid())
  orderId        String
  quoteId        String?
  linguistId     String
  languagePairId String
  status         AssignmentStatus @default(PENDING)
  assignedAt     DateTime         @default(now())
  acceptedAt     DateTime?
  declinedAt     DateTime?
  startedAt      DateTime?
  completedAt    DateTime?
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  languagePair   LanguagePair     @relation(fields: [languagePairId], references: [id])
  linguist       Linguist         @relation(fields: [linguistId], references: [id])
  order          Order            @relation(fields: [orderId], references: [id])
  quote          Quote?           @relation(fields: [quoteId], references: [id])

  @@unique([orderId, linguistId])
  @@index([orderId])
  @@index([linguistId])
  @@index([status])
}

model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique
  orderId       String    @unique
  customerId    String
  subtotal      Float
  tax           Float?
  total         Float
  issueDate     DateTime  @default(now())
  dueDate       DateTime
  paidAt        DateTime?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  customer      Customer  @relation(fields: [customerId], references: [id])
  order         Order     @relation(fields: [orderId], references: [id])
  payments      Payment[]

  @@index([customerId])
  @@index([invoiceNumber])
}

model Payment {
  id            String        @id @default(cuid())
  invoiceId     String
  amount        Float
  status        PaymentStatus @default(PENDING)
  method        String?
  transactionId String?
  processedAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  invoice       Invoice       @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([transactionId])
}

model ActivityLog {
  id         String   @id @default(cuid())
  action     String
  entityType String
  entityId   String
  changes    String?
  createdAt  DateTime @default(now())

  @@index([entityType, entityId])
  @@index([action])
}

enum UserRole {
  ADMIN
  CUSTOMER
  LINGUIST
  MANAGER
}

enum LanguageLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  NATIVE
  BILINGUAL
}

enum Discipline {
  TRANSLATION
  INTERPRETATION
  BOTH
}

enum QuoteStatus {
  DRAFT
  QUOTE_SENT
  NEGOTIATION_REVIEW
  FOLLOW_UP
  INVOICE_PAID
  INVOICE_NOT_PAID
  REJECTED_PRICE
  REJECTED_OTHER
  REFUND
  BAD_DEBT
}

enum ProjectStatus {
  IN_PROGRESS
  PAUSED
  REMOVED
  COMPLETED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  REVIEW
  COMPLETED
  CANCELLED
  INVOICED
  PAID
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum AssignmentStatus {
  PENDING
  ACCEPTED
  DECLINED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum LeadStatus {
  NEW
  ASSIGNED
  IN_PROCESS
  CONVERTED
  RECYCLED
  DEAD
}

model Lead {
  id                     String     @id @default(cuid())
  legacyId               String?    @unique // Original SugarCRM ID
  firstName              String?
  lastName               String
  email                  String?
  phone                  String?
  phoneMobile            String?
  phoneWork              String?
  phoneFax               String?
  company                String?
  title                  String?
  department             String?
  website                String?
  description            String?
  
  // Address
  addressStreet          String?
  addressCity            String?
  addressState           String?
  addressPostalCode      String?
  addressCountry         String?
  
  // Lead Info
  source                 String?     // Where the lead came from
  sourceDescription      String?
  status                 LeadStatus  @default(NEW)
  statusDescription      String?
  industry               String?
  referredBy             String?
  
  // Custom Fields from LinkCRM
  discipline             String?     // Translation, Interpretation, etc.
  sourceLanguage         String?
  targetLanguage         String?
  customerType           String?     // Individual, Corporate
  leadRanking            String?     // Hot, Warm, Cold
  
  // Interpretation Assignment Details
  assignmentDate         DateTime?
  assignmentTime         String?
  estimatedDuration      String?
  onSiteContact          String?
  contactPersonPhone     String?
  contactPersonEmail     String?
  assignmentAddress      String?
  assignmentCity         String?
  assignmentState        String?
  assignmentZipCode      String?
  isCertified            Boolean     @default(false)
  estimatedFees          String?
  numberOfParticipants   String?
  numberOfSpeakers       String?
  meetingType            String?
  requestedVendorId      String?
  
  // Conversion
  isConverted            Boolean     @default(false)
  convertedAt            DateTime?
  convertedToCustomerId  String?
  
  // System
  doNotCall              Boolean     @default(false)
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt

  @@index([email])
  @@index([status])
  @@index([lastName])
  @@index([company])
}

// Legacy Quotes from LinkCRM - all disciplines (Translation, Interpretation, etc.)
model LegacyQuote {
  id                    String    @id @default(cuid())
  legacyId              String    @unique // SugarCRM quote id
  number                String?   // Quote number (e.g., "10168")
  name                  String?   // Quote name/title
  description           String?
  
  // Billing Info
  billingAccount        String?
  billingAccountId      String?   // SugarCRM account id
  billingContact        String?
  billingContactId      String?   // SugarCRM contact id
  billingAddress        String?
  billingCity           String?
  billingState          String?
  billingPostal         String?
  billingCountry        String?
  
  // Shipping Info
  shippingAccount       String?
  shippingAccountId     String?
  shippingContact       String?
  shippingContactId     String?
  shippingAddress       String?
  shippingCity          String?
  shippingState         String?
  shippingPostal        String?
  shippingCountry       String?
  
  // Status & Dates
  stage                 String?   // Draft, Negotiation, Delivered, etc.
  expiration            DateTime?
  estimatedCompletion   DateTime?
  
  // Amounts
  subtotalAmount        Decimal?  @db.Decimal(16, 2)
  taxAmount             Decimal?  @db.Decimal(8, 2)
  shippingAmount        Decimal?  @db.Decimal(8, 2)
  totalAmount           Decimal?  @db.Decimal(16, 2)
  paymentsReceived      Decimal?  @db.Decimal(8, 2)
  balanceDue            Decimal?  @db.Decimal(8, 2)
  
  // Payment Info
  paymentDate           DateTime?
  paymentType           String?
  checkNumber           String?
  
  // Service Details (for all disciplines)
  discipline            String?   // Translation, Interpretation, etc.
  sourceLanguage        String?
  targetLanguage        String?
  
  // Assignment Details (primarily for Interpretation)
  assignmentDate        DateTime?
  assignmentTime        String?
  estimatedDuration     String?
  onSiteContact         String?
  contactPersonPhone    String?
  contactPersonEmail    String?
  
  // Other
  terms                 String?
  ponumber              String?
  opportunityId         String?
  gsa                   Boolean   @default(false)
  partnerId             String?
  
  // Relations
  assignedUserId        String?
  
  // System
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([number])
  @@index([billingAccountId])
  @@index([billingContactId])
  @@index([stage])
  @@index([discipline])
}
